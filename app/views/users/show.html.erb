<div id="user-show">
  <!-- 固定表示：プルダウン＋ユーザー情報カード -->
  <div class="sticky-top bg-white z-3 border-bottom">
    <div class="container py-3 pt-4">
  
      <!-- 年月度プルダウンです -->
      <%= render 'shared/month_selector' %>
  
      <!-- ユーザー情報カード -->
      <div class="card shadow mb-3">
        <div class="card-body d-flex justify-content-between align-items-start" style="background-color: #dee2e6;">
          <div>
            <h3 class="card-title"><%= @user.name %></h3>
            <p class="mb-1"><strong>📧 メール:</strong> <%= @user.email %></p>
            <p class="mb-1"><strong>🤏 レベル:</strong> <%= @user.level_label %></p>
            <p class="mb-0"><strong>🆔 LステップID:</strong> <code class="text-purple"><%= @user.lstep_user_id.presence || "未登録" %></code></p>
          </div>
          <div class="text-end">
            <p>本人売上：<%= number_with_delimiter(@user.own_monthly_sales_total(@selected_month)) %>円</p>
            <p>下位売上：<%= number_with_delimiter(@user.total_sales_with_descendants(@selected_month) - @user.own_monthly_sales_total(@selected_month)) %>円</p>
            <p>合計売上：<strong><%= number_with_delimiter(@user.total_sales_with_descendants(@selected_month).to_i) %></strong> 円</p>
            <p>ボーナス：<strong class="text-success"><%= number_with_delimiter(@user.bonus_in_month(@selected_month).to_i) %></strong>円</p>
          </div>
        </div>
      </div>
  
    </div>
  </div>
  
  <!-- 下位紹介者カード一覧 -->
  <div class="container" style="margin-top: 2rem; padding-top: 4rem;">
    <div class="card shadow">
      <div class="card-header bg-light">
        <h5 class="mb-0">👇 下位紹介者</h5>
      </div>
      <div class="card-body">
        <% if @user.referrals.any? %>
          <% @user.referrals.each_with_index do |ref_user, i| %>
            <div class="card mb-3 hover-pointer" onclick="window.location.href='<%= user_path(ref_user) %>'">
              <div class="card-body">
                <!-- デスクトップ表示 -->
                <div class="d-none d-md-block">
                  <div class="row align-items-start">
                    <div class="col-md-8">
                      <p class="mb-1 fw-bold text-success">#<%= i + 1 %>. <%= ref_user.name %>（<%= ref_user.level_label %>）</p>
                      <p class="mb-1 text-break">📧 <%= ref_user.email %></p>
                      <p class="mb-1">🆔 <code class="text-purple"><%= ref_user.lstep_user_id.presence || "未登録" %></code></p>
                      <p class="mb-1">売上：<%= number_with_delimiter(ref_user.total_sales_with_descendants(@selected_month).to_i) %>円</p>
                      <p class="mb-0">ボーナス：<%= number_with_delimiter(ref_user.bonus_in_month(@selected_month).to_i) %>円</p>
                    </div>
                    <div class="col-md-4 text-end">
                      <%= link_to "売上明細", sales_path(user_id: ref_user.id, month: @selected_month), class: "btn btn-outline-primary btn-sm", onclick: "event.stopPropagation();" %>
                    </div>
                  </div>
                </div>

                <!-- モバイル表示 -->
                <div class="d-md-none">
                  <div class="text-center mb-2">
                    <p class="mb-1 fw-bold text-success">#<%= i + 1 %>. <%= ref_user.name %>（<%= ref_user.level_label %>）</p>
                  </div>
                  
                  <div class="mb-2">
                    <p class="mb-1 small text-break">📧 <%= ref_user.email %></p>
                    <p class="mb-1 small">🆔 <code class="text-purple"><%= ref_user.lstep_user_id.presence || "未登録" %></code></p>
                  </div>
                  
                  <div class="text-center mb-2">
                    <p class="mb-1 small">売上：<%= number_with_delimiter(ref_user.total_sales_with_descendants(@selected_month).to_i) %>円</p>
                    <p class="mb-2 small">ボーナス：<%= number_with_delimiter(ref_user.bonus_in_month(@selected_month).to_i) %>円</p>
                    <%= link_to "売上明細", sales_path(user_id: ref_user.id, month: @selected_month), class: "btn btn-outline-primary btn-sm", onclick: "event.stopPropagation();" %>
                  </div>
                </div>
              </div>
            </div>
          <% end %>
        <% else %>
          <p class="text-muted mb-0">下位紹介者なし</p>
        <% end %>
      </div>
    </div>
  
    <!-- 戻るボタン -->
    <div class="d-flex justify-content-center gap-3 mt-4 mb-5">
      <%= link_to "🏠 マイページに戻る", mypage_path, class: "btn btn-outline-secondary" %>
      <% if @user.referrer.present? %>
        <%= link_to "🔼 1つ上位に戻る", user_path(@user.referrer), class: "btn btn-outline-secondary" %>
      <% end %>
    </div>
  </div>
</div>

<!-- スタイル -->
<style>
/*.hover-pointer:hover {*/
/*    background-color: #f8f9fa;*/
/*    cursor: pointer;*/
/*  }*/

/*  .text-purple {*/
/*    color: #8e44ad;*/
/*  }*/

/*  .sticky-top {*/
/*    position: sticky;*/
    top: 60px; /* ← ここを0から60pxなどに変更 */
/*    z-index: 1030;*/
/*    background-color: white;*/
/*  }*/
</style>
